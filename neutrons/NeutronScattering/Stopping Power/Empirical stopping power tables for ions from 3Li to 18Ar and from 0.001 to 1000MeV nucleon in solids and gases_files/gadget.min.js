!function(){"use strict";var e=function(){this.key="616daef638f56a44b3cc9fdccbd4386f",this.newsSources={},this.issns={22150161:!0,"01406736":!0,14702045:!0,14733099:!0,"02779536":!0,"07475632":!0,"01956663":!0,"03069877":!0,"00283932":!0,"1356689X":!0,"00039993":!0,"01960644":!0,"1054139X":!0,"07493797":!0,"00221031":!0,"03601315":!0,"03009572":!0,"09209964":!0,"00029343":!0,"00150282":!0,"03014215":!0,"00928674":!0,"08966273":!0,"09609822":!0,"01695347":!0,13646613:!0,"2214109X":!0},this.group=this.getGroup(),this.barGroup=1,this.donutGroup=0,this.showHighlights=!0,this.showSharing=!0};e.prototype.getGroup=function(){var e,t=/\baltmetric_group=([^;]+)\b/.exec(document.cookie);return t?e=parseInt(t[1],10):(e=Math.floor(10*Math.random())%2+1,document.cookie="altmetric_group="+e),e},e.prototype.fetch=function(e,t){gadgets.sciverse.makeRequest("http://api.altmetric.com/v1/fetch/doi/"+e+"?include_sources=news&include_sections=counts,images,posts,altmetric_score,citation&key="+this.key,t,{CONTENT_TYPE:"JSON"})},e.prototype.getNewsSources=function(e){gadgets.io.makeRequest("http://assets.altmetric.com/javascript/top_news_sources.json",function(t){if(0===t.errors.length){var i,r={},a=t.data.news_sources.length;for(i=0;a>i;i+=1)r[t.data.news_sources[i]]=!0;e(r)}},{CONTENT_TYPE:"JSON"})},e.prototype.getSources=function(e){gadgets.io.makeRequest("http://assets.altmetric.com/javascript/sources.json",function(t){if(0===t.errors.length){var i,r,a={},s=t.data.sources.length;for(i=0;s>i;i+=1)r=t.data.sources[i],a[r.fetch_api_key]={template:r.legend_text,color:r.dark_colour,label:r.tab_label,position:r.position},"news"===r.fetch_api_key&&(a[r.fetch_api_key].label="news sources"),"blogs"===r.fetch_api_key&&(a[r.fetch_api_key].label="blogs");e(a)}},{CONTENT_TYPE:"JSON"})},e.prototype.render=function(e,t){var i=this;t.className=this.group===this.barGroup?"bar_group":"donut_group",this.renderTitle(t),this.renderDonut(e,t),this.renderSources(e,t),this.getNewsSources(function(r){i.newsSources=r,i.renderHighlights(e,t),i.showSharing&&i.renderSharingButtons(e,t,!1),gadgets.window.adjustHeight(1),setTimeout(gadgets.window.adjustHeight,1)}),gadgets.sciverse.makeMeVisible()},e.prototype.renderTitle=function(e){var t=document.createElement("div");t.id="title_panel",t.innerHTML="Article level metrics",e.appendChild(t)},e.prototype.renderSharingButtons=function(e,t,i){var r,a=document.createElement("div"),s=[],o="";a.id="share_panel",e.citation.hasOwnProperty("doi")?r=encodeURIComponent("http://dx.doi.org/"+e.citation.doi):e.citation.hasOwnProperty("links")&&(r=encodeURIComponent(e.citation.links[0])),void 0!==r&&(e.citation.hasOwnProperty("title")&&(o=encodeURIComponent(e.citation.title)),s.push("<div class='share_button'><a data-label='twitter_share' target='_blank' href='https://twitter.com/intent/tweet?related=elsevierconnect,sciencedirect,altmetric&text="+o+"&url="+r+"'><img src='http://assets.altmetric.com/images/social/twitter.png'/> Twitter</a></div>"),s.push("<div class='share_button'><a data-label='facebook_share' target='_blank' href='https://www.facebook.com/sharer/sharer.php?u="+r+"'><img src='http://assets.altmetric.com/images/social/facebook.png'/> Facebook</a></div>"),s.push("<div class='share_button'><a data-label='googleplus_share' target='_blank' href='https://plus.google.com/share?url="+r+"'><img src='http://assets.altmetric.com/images/social/googleplus.png'/> Google+</a></div>"),a.className=i?"stacked":"line",a.innerHTML="<div id='share_panel_label'>Share this article</div><div id='share_buttons_set'>"+s.join("")+"</div>",t.appendChild(a))},e.prototype.renderDonut=function(t,i){var r=document.createElement("img"),a=document.createElement("a"),s=document.createElement("span");r.src=t.images.small,r.width=64,r.height=r.width,r.id="donut-image",this.group===this.barGroup&&(r.src=t.images.medium,r.id="bar-image",r.src=/style=(\w+)/.test(r.src)?r.src.replace(/style=(\w+)/,"style=bar"):r.src+"&style=bar",r.width=80,r.height=18,r.align="top"),a.href="#",a.id="donut-canvas-link",a.className="clearfix",a.setAttribute("data-label","Details page for "+t.citation.doi),a.appendChild(r),this.group===this.barGroup&&(s.innerHTML=Math.ceil(t.altmetric_score.score),s.id="donut-score",a.appendChild(s)),e.click(a,function(e){e&&e.preventDefault&&e.preventDefault(),gadgets.views.requestNavigateTo(new gadgets.views.View("canvas"),{doi:t.citation.doi},"")}),i.appendChild(a)},e.prototype.ordinalize=function(e){var t=e.toString(),i=t.slice(-1),r=t.slice(-2),a="";switch(i){case"1":a="11"===r?"th":"st";break;case"2":a="12"===r?"th":"nd";break;case"3":a="13"===r?"th":"rd";break;default:a="th"}return t+a},e.prototype.random=function(e){return e[Math.floor(Math.random()*e.length)]},e.prototype.findHighlights=function(e,t,i,r,a){var s,o,n;t.hasOwnProperty(i)&&(s=t[i].rank,o=t[i].total_number_of_other_articles,n=t[i].percentile,1===s?e.push("This is the <b>highest scoring article</b> "+r):10>=s&&e.push("This is the <b>"+this.ordinalize(s)+" highest scoring article</b> "+r),o>50&&(n>=90?e.push('In terms of the <a target="_blank" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has done particularly well</b>, scoring higher than '+n+"% of "+a):n>=75?e.push('In terms of the <a target="_blank" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has done well</b>, scoring higher than '+n+"% of "+a):n>=50&&e.push('In terms of the <a target="_blank" href="http://support.altmetric.com/knowledgebase/articles/84649-about-altmetric-and-the-altmetric-score">Altmetric score</a> this article <b>has gotten more attention than average</b>, scoring higher than '+n+"% of "+a)))},e.prototype.renderSources=function(e,t){var i,r=this,a=document.createElement("div");a.className=this.group===this.barGroup?"bar_panel":"donut_panel",this.getSources(function(t){var s,o,n=0,c=[],l="";a.id="panel";for(s in e.counts)e.counts.hasOwnProperty(s)&&"total"!==s&&(o=t[s],o&&o.label&&c.push([e.counts[s].posts_count,o.label]));for(n=c.length,c.sort(function(e,t){return t[0]-e[0]}),i=0;n>i;i+=1)i>0&&(i===n-1?l+=" and ":n>1&&(l+=", ")),l+=c[i][1];a.innerHTML="<p>This article has gotten attention from "+l+". </p>",r.renderCanvasLink(e,a.firstChild),gadgets.window.adjustHeight(1),setTimeout(gadgets.window.adjustHeight,1)}),t.appendChild(a)},e.prototype.renderHighlights=function(e,t){var i,r,a,s,o=[],n=[],c="This article was covered by ";if(e.altmetric_score.hasOwnProperty("context_for_score")&&e.counts.total.posts_count>3&&(this.findHighlights(o,e.altmetric_score.context_for_score,"this_journal","in this journal that we have seen so far.","other articles in this journal."),this.findHighlights(o,e.altmetric_score.context_for_score,"similar_age_this_journal_3m","compared to other articles published in this journal and in the same time period.","articles from the same journal published in the same time period."),this.findHighlights(o,e.altmetric_score.context_for_score,"all","ever tracked by Altmetric.","other articles ever tracked by Altmetric.")),e.posts.hasOwnProperty("news")){for(s=e.posts.news.length,r=0;s>r;r+=1)a=e.posts.news[r],a.hasOwnProperty("author")&&this.newsSources.hasOwnProperty(a.author.name)&&n.push('<a target="_blank" href="'+a.url+'">'+a.author.name+"</a>");if(n.length>=5&&(n=n.slice(0,4)),n.length>=1){for(r=0;r<n.length;r+=1)c+=n[r],r<n.length-2?c+=", ":r<n.length-1&&(c+=" and ");c+=n.length<e.posts.news.length?", amongst other outlets.":".",o=[c]}}o.length&&(i=document.createElement("p"),this.group===this.barGroup&&(i.className="bar_panel"),i.id="highlight",i.innerHTML=this.random(o),this.showHighlights&&t.appendChild(i))},e.click=function(e,t){var i;e.addEventListener?e.addEventListener("click",t,!1):e.attachEvent?e.attachEvent("onclick",t):e.onclick?(i=e.onclick,e.onclick=function(){i(),t()}):e.onclick=t},e.prototype.renderCanvasLink=function(t,i){var r=document.createElement("span");r.innerHTML='<a href="#" data-label="Details page for '+t.citation.doi+'" id="canvas-link">Click for more details.</a>',e.click(r.firstChild,function(e){e&&e.preventDefault&&e.preventDefault(),gadgets.views.requestNavigateTo(new gadgets.views.View("canvas"),{doi:t.citation.doi},"")}),i.appendChild(r)},function(){var e=document.createElement("link");e.href="http://assets.altmetric.com/widgets/sciencedirect/gadget.min.css?v=1",e.rel="stylesheet",document.documentElement.firstChild.appendChild(e)}(),gadgets.sciverse.getContextInfo(function(t){var i=new e;i.issns.hasOwnProperty(t.issn)&&i.fetch(t.doi,function(e){var t=document.getElementById("profile");0===e.errors.length&&i.render(e.data,t)})})}();
//# sourceMappingURL=gadget.min.js.map
